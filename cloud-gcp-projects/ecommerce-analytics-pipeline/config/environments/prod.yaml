# Production Environment Configuration
# E-commerce Analytics Pipeline

environment: "prod"
gcp:
  project_id: "your-prod-project-id"
  region: "us-central1"
  zone: "us-central1-a"
  service_account_key_path: "config/credentials/prod-service-account.json"
  use_default_credentials: false

bigquery:
  dataset_id: "ecommerce_analytics_prod"
  project_id: "your-prod-project-id"
  location: "US"
  default_table_expiration_ms: 7776000000  # 90 days
  clustering_fields: ["date", "customer_id", "product_id"]

storage:
  bucket_name: "ecommerce-analytics-prod-raw-data"
  processed_bucket: "ecommerce-analytics-prod-processed"
  curated_bucket: "ecommerce-analytics-prod-curated"
  retention_days: 365
  compression: "gzip"

data_sources:
  customer_orders:
    type: "csv"
    path: "data/raw/customer_orders.csv"
    encoding: "utf-8"
    delimiter: ","
    header: true
  
  product_catalog:
    type: "csv"
    path: "data/raw/product_catalog.csv"
    encoding: "utf-8"
    delimiter: ","
    header: true
  
  web_analytics:
    type: "json"
    path: "data/raw/web_analytics.json"
    api_endpoint: "https://api.production.com/analytics"
    api_key: "${WEB_ANALYTICS_API_KEY}"
  
  inventory:
    type: "csv"
    path: "data/raw/inventory.csv"
    encoding: "utf-8"
    delimiter: ","
    header: true

api_config:
  timeout_seconds: 60
  retry_attempts: 5
  retry_delay_seconds: 10
  rate_limit_per_minute: 1000

data_quality:
  validation_rules:
    customer_orders:
      required_fields: ["order_id", "customer_id", "order_date", "total_amount"]
      data_types:
        order_id: "string"
        customer_id: "string"
        order_date: "datetime"
        total_amount: "float"
      constraints:
        total_amount: ">= 0"
        order_date: ">= 2020-01-01"
    
    product_catalog:
      required_fields: ["product_id", "product_name", "category", "price"]
      data_types:
        product_id: "string"
        product_name: "string"
        category: "string"
        price: "float"
      constraints:
        price: ">= 0"
  
  quality_threshold: 0.98
  enable_auto_correction: false
  log_quality_issues: true

business_rules:
  customer_segments:
    high_value: "total_spent >= 1000"
    medium_value: "total_spent >= 500 AND total_spent < 1000"
    low_value: "total_spent < 500"
  
  product_categories:
    electronics: ["laptop", "phone", "tablet", "accessories"]
    clothing: ["shirt", "pants", "dress", "shoes"]
    home: ["furniture", "decor", "kitchen", "garden"]
  
  revenue_calculations:
    gross_revenue: "sum(total_amount)"
    net_revenue: "sum(total_amount - discount_amount)"
    average_order_value: "avg(total_amount)"

aggregation:
  time_periods:
    - "daily"
    - "weekly"
    - "monthly"
    - "quarterly"
    - "yearly"
  
  customer_metrics:
    - "total_orders"
    - "total_spent"
    - "average_order_value"
    - "last_order_date"
    - "customer_lifetime_value"
  
  product_metrics:
    - "total_sold"
    - "total_revenue"
    - "average_rating"
    - "inventory_turnover"

loading:
  bigquery_write_disposition: "WRITE_APPEND"
  storage_format: "parquet"
  enable_partitioning: true
  partition_field: "date"
  clustering_enabled: true
  
  materialized_views:
    refresh_interval_ms: 900000  # 15 minutes
    enable_auto_refresh: true

pipeline:
  log_level: "WARNING"
  enable_monitoring: true
  enable_alerting: true
  max_retries: 5
  timeout_minutes: 120
  
  scheduling:
    extraction_interval_minutes: 5
    transformation_interval_minutes: 15
    loading_interval_minutes: 20
  
  parallel_processing:
    max_workers: 16
    chunk_size: 5000
    enable_streaming: true

monitoring:
  cloud_monitoring:
    enabled: true
    project_id: "your-prod-project-id"
    custom_metrics: true
  
  alerting:
    enabled: true
    slack_webhook: "${SLACK_WEBHOOK_URL}"
    email_recipients: ["data-team@company.com", "oncall@company.com"]
    
    rules:
      - name: "Pipeline Failure"
        condition: "status == 'failed'"
        severity: "critical"
        description: "ETL pipeline execution failed"
      
      - name: "Data Quality Below Threshold"
        condition: "quality_score < 0.98"
        severity: "critical"
        description: "Data quality score below production threshold"
      
      - name: "High Error Rate"
        condition: "error_rate > 0.01"
        severity: "critical"
        description: "Error rate exceeds 1% production threshold"
      
      - name: "Pipeline Performance Degradation"
        condition: "execution_time > 60"
        severity: "warning"
        description: "Pipeline execution time exceeds 60 minutes"
  
  health_checks:
    enabled: true
    check_interval_minutes: 5
    timeout_seconds: 60

security:
  encryption:
    at_rest: true
    in_transit: true
  
  access_control:
    principle_of_least_privilege: true
    service_account_rotation_days: 30
  
  audit_logging:
    enabled: true
    log_level: "INFO"
    retention_days: 2555  # 7 years

testing:
  unit_tests:
    enabled: true
    coverage_threshold: 0.90
  
  integration_tests:
    enabled: true
    test_data_size: "medium"
  
  data_quality_tests:
    enabled: true
    sample_size: 10000
  
  performance_tests:
    enabled: true
    timeout_seconds: 600

backup:
  enabled: true
  retention_days: 2555
  backup_interval_hours: 24
  cross_region: true

disaster_recovery:
  enabled: true
  rto_minutes: 60
  rpo_minutes: 15
  multi_region: true
